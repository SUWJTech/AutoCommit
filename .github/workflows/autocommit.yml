name: Auto commit

on:
  push:
    branches:
      - master
  schedule:
    - cron: "0 0,6,12 * * *"

jobs:
  auto_commit:
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          ref: master
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: é…ç½®Git
        run: |
          git config --global user.email "erickyknoff@gmail.com"
          git config --global user.name "SUWJTech"
          # é…ç½®è¿œç¨‹ä»“åº“å¸¦ä»¤ç‰Œ
          git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/SUWJTech/AutoCommit.git

      - name: å¼ºåˆ¶åŒæ­¥è¿œç¨‹æœ€æ–°ä»£ç 
        run: |
          git fetch --all
          git reset --hard origin/master
          git pull origin master --no-rebase

      - name: ä¿®æ”¹æ›´æ–°æ—¶é—´æ–‡ä»¶
        run: |
          date '+%Y-%m-%dT%H:%M:%SZ' > LAST_UPDATED

      - name: æäº¤æ›´æ”¹
        run: |
          git add LAST_UPDATED
          
          # éšæœºæäº¤ä¿¡æ¯
          messages=("ğŸ˜‚" "ğŸ˜±" "ğŸ‘¿" "ğŸ’©" "ğŸ™" "ğŸ™ˆ" "ğŸ" "ğŸ¤–" "ğŸŸ©" "ğŸ‘»")
          emoji=${messages[$RANDOM % ${#messages[@]}]}
          git commit -m "chore(bot): $emoji auto commit" || echo "æ— æ›´æ”¹å¯æäº¤"

      - name: å†æ¬¡æ‹‰å–ä»¥é˜²æœ€åä¸€åˆ»çš„å†²çª
        run: git pull origin master --no-rebase

      - name: ç›´æ¥ä½¿ç”¨git pushæ¨é€ï¼ˆæ›¿ä»£actionï¼‰
        run: git push origin master

