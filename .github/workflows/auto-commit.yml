name: Auto commit

on:
  push:
    branches:
      - master
  schedule:
    - cron: "0 0,6,12 * * *" # æ¯å¤© 0ç‚¹ã€6ç‚¹ã€12ç‚¹ è‡ªåŠ¨æ‰§è¡Œ

jobs:
  auto_commit:
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          ref: master
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: é…ç½® Git
        run: |
          git config --global user.email "erickyknoff@gmail.com"
          git config --global user.name "SUWJTech"
          git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/SUWJTech/AutoCommit.git

      - name: åŒæ­¥è¿œç¨‹æœ€æ–°ä»£ç 
        run: |
          git fetch origin master
          git reset --hard origin/master

      - name: ä¿®æ”¹æ›´æ–°æ—¶é—´æ–‡ä»¶
        run: |
          date '+%Y-%m-%dT%H:%M:%SZ' > LAST_UPDATED

      - name: æäº¤æ›´æ”¹
        run: |
          git add LAST_UPDATED
          messages=("ğŸ˜‚" "ğŸ˜±" "ğŸ‘¿" "ğŸ’©" "ğŸ™" "ğŸ™ˆ" "ğŸ" "ğŸ¤–" "ğŸŸ©" "ğŸ‘»")
          emoji=${messages[$RANDOM % ${#messages[@]}]}
          git commit -m "chore(bot): $emoji auto commit" || echo "æ— æ›´æ”¹å¯æäº¤"

      - name: æ‹‰å–æœ€æ–°å¹¶åˆå¹¶
        run: |
          git fetch origin master
          git rebase origin/master || git rebase --abort

      - name: æ¨é€æ›´æ”¹ï¼ˆå¼ºåˆ¶è¦†ç›–è¿œç¨‹ï¼‰
        run: git push origin master --force
